# Synctacles Care - Home Assistant App Configuration
# https://developers.home-assistant.io/docs/add-ons/configuration

name: "Synctacles Care"
version: "0.3.0-rc8"
slug: "synctacles_care"
description: "System diagnostics, cleanup, and AI-powered troubleshooting for Home Assistant"
url: "https://github.com/synctacles/care-app"
arch:
  - amd64
  - aarch64
  - armv7
init: false
startup: application
boot: auto
homeassistant_api: true
hassio_api: true
hassio_role: manager

# Docker image on GHCR (HA Supervisor replaces {arch} with amd64/aarch64/armv7)
image: "ghcr.io/synctacles/{arch}-care"

# App options
options:
  ai_api_key: ""
  notifications_enabled: true
  scheduled_scan_enabled: false
  auto_cleanup_enabled: false
  autonomous_mode_enabled: false
  debug_mode: false
  demo_mode: false
  telemetry_enabled: false

# Schema for options validation
schema:
  ai_api_key: password?
  notifications_enabled: bool
  scheduled_scan_enabled: bool
  auto_cleanup_enabled: bool
  autonomous_mode_enabled: bool
  debug_mode: bool
  demo_mode: bool
  telemetry_enabled: bool

# Web UI
ingress: true
ingress_port: 8080
panel_icon: mdi:hospital-box
panel_title: "Synctacles Care"

# Resource requirements
host_network: false
host_ipc: false
privileged: []
full_access: false

# Services
services:
  - mqtt:want

# Map host directories (optional, for advanced users)
map:
  - config:rw

# Environment
environment:
  SYNCTACLES_ENVIRONMENT: "production"

# Changelog
changelog: |
  ## 0.3.0-rc9
  - NEW: AI batch recipes — AI proposes HA service calls, you review & approve before execution
  - NEW: Autonomous mode — AI acts independently within strict time & action limits (opt-in)
  - NEW: Multi-turn AI chat with full conversation history
  - NEW: Pre-recipe safety backups — automatic backup before executing proposed actions
  - NEW: Execution audit log — full traceability of all AI-executed actions
  - Safety: Service blocklist prevents dangerous operations (restart, shutdown, purge)
  - Updated: Documentation with all AI features
  ## 0.3.0-rc8
  - NEW: Shared breadcrumb navigation — always shows current section (AI Assist › Diagnose / Config Doctor › item)
  - Fixed: Diagnose blank screen after stale session — form now resets correctly on navigation
  - NEW: Config Doctor category tabs — Automations active, Blueprints/Dashboards coming soon
  - UX: Cleanup backups button moved to breadcrumb bar — accessible from all Config Doctor steps
  ## 0.3.0-rc7
  - NEW: Interactive AI chat — ask follow-up questions instead of single-turn sessions
  - NEW: Multi-turn conversation with full message history
  - Fixed: Clean up backups button now clearly visible with icon
  ## 0.3.0-rc6
  - Fixed: Automation list shows red badge with entity issue count (not misleading green)
  - Fixed: Rollback shows original YAML when HA rejects it (instead of generic error)
  - NEW: Clean up backups button on automation list
  ## 0.3.0-rc5
  - NEW: Config Doctor entity validation — auto-checks all entity_ids against your system
  - NEW: Suggestion picker for invalid entities (fuzzy match by domain)
  - NEW: Restore Original button visible in preview when backup exists
  ## 0.3.0-rc4
  - Fixed: README/Info page updated (was showing 0.1.1-beta)
  - Fixed: Build now uses correct source branch (rc3 code was never deployed)
  ## 0.3.0-rc3
  - NEW: AI Assist hub with Diagnose, Config Doctor, and Builder
  - NEW: Config Doctor — AI-powered automation analysis with fix, backup, and rollback
  - Fixed: AI tab blank after page reload, session reset, terminal blocking intake
  - Fixed: Changelog display, slow startup, attach-to-AI empty lines
  - Tab renamed: "AI Support" → "AI Assist" (all 8 languages)
  ## 0.3.0-rc2
  - Fixed: Disclaimer modal centering
  - Fixed: Changelog not loading in About tab
  - Fixed: AI tab blank after first use (status race condition)
  - Updated: Documentation with current features
  ## 0.3.0-rc1
  - Disclaimer/liability notice on first install (8 languages)
  - About tab with app info, features, changelog
  - Live terminal panel in AI tab (xterm.js + SSE log streaming)
  - Feedback loop: resolved bug notifications
  - Always-on anonymous telemetry (no opt-in toggle)
  - Silent radar logs (no more "radar:" messages in addon logs)
  - AI tab session reset fix (no longer blank after first use)
  - Fast startup: web UI loads instantly, background services deferred
  - KB search language filter for FAQ articles
  ## 0.2.2-beta
  - New 6-tab dashboard with dark mode and 8-language support
  - AI model selection: choose between Haiku, Sonnet, or Opus
  - Dedicated Feedback tab with structured bug reports
  - Knowledge Base search with rate limiting
  - Fixed KB search and category display
  - Removed unused config options (api_key, license_key)
  - Config descriptions in English and Dutch
  ## 0.2.0-beta
  - BYOK AI: use your own Anthropic API key for AI diagnostics
  - Synctacles Radar: silent error fingerprinting (Phase 1)
  - Full environment snapshot sent with radar data
  - Auth/license dependencies removed (all features free)
  - Backend URL updated to Cloudflare Worker (api.synctacles.com)
  - Decoupled from care-backend WebSocket relay
  ## 0.1.0-beta

  - Initial beta release
  - Health scan (A-F score)
  - Security scan (0-100 score)
  - Orphan entity detection
  - Knowledge base search (17,000+ articles)
  - AI diagnostics (with user's Anthropic API key)
  - Free tier: All features unlocked
  - Privacy-focused: Optional telemetry, GDPR-compliant
